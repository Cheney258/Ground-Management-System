{"remainingRequest":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\src\\views\\admin\\Equip\\Equip.vue?vue&type=style&index=0&id=11a29367&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\src\\views\\admin\\Equip\\Equip.vue","mtime":1648978252226},{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\22419\\Desktop\\校园运动场地管理系统\\app\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmZvcm0gew0KICB3aWR0aDogNDUwcHg7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgbGVmdDogNTAlOw0KICBtYXJnaW4tbGVmdDogLTMwMHB4Ow0KICB0b3A6IDYwJTsNCn0NCi5zZWxlY3R7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOjEyMHB4Ow0KICAgIA0KfQ0KLnNlbGVjdCAvZGVlcC8gLmVsLWlucHV0X19pbm5lcnsNCiAgICBib3JkZXItcmFkaXVzOiAwIDVweCA1cHggMCFpbXBvcnRhbnQ7IA0KfQ0KLmJ0bnsNCiAgICBtYXJnaW4tbGVmdDogMTUlOw0KICAgIGJvcmRlci1yYWRpdXM6IDVweCAwIDAgNXB4Ow0KfQ0K"},{"version":3,"sources":["Equip.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Equip.vue","sourceRoot":"src/views/admin/Equip","sourcesContent":["<template>\r\n  <div>\r\n    <el-card>\r\n      <div slot=\"header\">\r\n        <el-button type=\"primary\" class=\"btn\">切换</el-button>\r\n        <el-select\r\n          v-model=\"select\"\r\n          @change=\"change\"\r\n          clearable\r\n          placeholder=\"选择器材类型\"\r\n          class=\"select\"\r\n        >\r\n          <el-option\r\n            v-for=\"(item, index) in equiptype\"\r\n            :key=\"index\"\r\n            :label=\"item.type\"\r\n            :value=\"item.tid\"\r\n          >\r\n          </el-option>\r\n        </el-select>\r\n        <el-button\r\n          type=\"primary\"\r\n          style=\"margin-left: 100px\"\r\n          @click=\"isShow = true\"\r\n        >\r\n          + 新增\r\n        </el-button>\r\n        <el-button type=\"warning\" style=\"margin-left: 30px\" @click=\"deletes\"\r\n          >批量删除</el-button\r\n        >\r\n      </div>\r\n      <div>\r\n        <el-table\r\n          :data=\"showList\"\r\n          ref=\"multipleTable\"\r\n          @selection-change=\"handleSelectionChange\"\r\n          style=\"width: 100%\"\r\n          stripe\r\n        >\r\n          <el-table-column type=\"selection\" width=\"55\"> </el-table-column>\r\n          <el-table-column prop=\"eid\" label=\"器材ID\" width=\"120\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"type\"\r\n            label=\"器材类型\"\r\n            width=\"width\"\r\n            align=\"center\"\r\n          >\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"equipname\"\r\n            label=\"器材名称\"\r\n            width=\"width\"\r\n            align=\"center\"\r\n          >\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"rentstatus\"\r\n            label=\"借用状态\"\r\n            width=\"width\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <el-tag type=\"success\" v-if=\"row.rentstatus == 0\">未借出</el-tag>\r\n              <el-tag type=\"danger\" v-if=\"row.rentstatus == 1\">已借出</el-tag>\r\n              <el-tag type=\"danger\" v-if=\"row.rentstatus == 2\">未归还</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"status\"\r\n            label=\"器材状态\"\r\n            width=\"width\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <el-tag type=\"success\" v-if=\"row.status == 0\">完好</el-tag>\r\n              <el-tag type=\"warning\" v-if=\"row.status == 1\">报修</el-tag>\r\n              <el-tag type=\"danger\" v-if=\"row.status == 2\">损坏</el-tag>\r\n              <el-tag type=\"info\" v-if=\"row.status == 3\">报废</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            prop=\"prop\"\r\n            label=\"操作\"\r\n            width=\"width\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"{ row }\">\r\n              <el-button type=\"success\" @click=\"handle(row, 0)\"\r\n                >已修复</el-button\r\n              >\r\n              <el-button type=\"info\" @click=\"handle(row, 1)\">报修</el-button>\r\n              <el-button type=\"warning\" @click=\"handle(row, 2)\">报废</el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </div>\r\n      <pagination\r\n        :currentPage=\"currentPage\"\r\n        :total=\"total\"\r\n        :limit=\"limit\"\r\n        :page-sizes=\"pageSizes\"\r\n        @handleCurrentChange=\"handleCurrentChange\"\r\n        @handleSizeChange=\"handleSizeChange\"\r\n      />\r\n    </el-card>\r\n\r\n    <el-dialog title=\"新增器材\" :visible.sync=\"isShow\" width=\"500px\">\r\n      <div style=\"width: 520px; margin: 50px auto\">\r\n        <el-form\r\n          :model=\"equipinfo\"\r\n          label-width=\"202px\"\r\n          :rules=\"rules\"\r\n          ref=\"form\"\r\n          class=\"form\"\r\n        >\r\n          <el-form-item label=\"器材类型：\" prop=\"type\">\r\n            <el-input v-model=\"equipinfo.type\" style=\"width: 202px\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"器材ID：\" prop=\"eid\">\r\n            <el-input v-model=\"equipinfo.eid\" style=\"width: 202px\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"器材名称：\" prop=\"equipname\">\r\n            <el-input\r\n              v-model=\"equipinfo.equipname\"\r\n              style=\"width: 202px\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"损坏赔偿：\">\r\n            <el-input\r\n              v-model=\"equipinfo.compensation\"\r\n              style=\"width: 202px\"\r\n              placeholder=\"如：20元/件\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"*注意：\" prop=\"equipname\">\r\n            <span style=\"color: red; font-weight: 700\"\r\n              >已经存在的器材类型不需要填损失赔偿</span\r\n            >\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"isShow = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"add\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Equip\",\r\n\r\n  data() {\r\n    return {\r\n      isShow: false,\r\n      select: \"\",\r\n      equipList: [],\r\n      showList: [],\r\n      equiptype: [],\r\n      equipinfo: {\r\n        eid: \"\",\r\n        type: \"\",\r\n        equipname: \"\",\r\n        compensation: \"\",\r\n      },\r\n      currentPage: 1,\r\n      limit: 5,\r\n      total: 0,\r\n      pageSizes:[5,10,15,20],\r\n      rules: {\r\n        eid: [\r\n          { required: true, message: \"必填项\", trigger: \"blur\" },\r\n          { pattern: /^\\d{4}$/, message: \"请输入4位数字\", trigger: \"blur\" },\r\n        ],\r\n        type: [{ required: true, message: \"必填项\", trigger: \"blur\" }],\r\n        equipname: [{ required: true, message: \"必填项\", trigger: \"blur\" }],\r\n        compensation: [{ required: false }],\r\n      },\r\n    };\r\n  },\r\n\r\n  mounted() {\r\n    this.getAllEquipInfo();\r\n  },\r\n\r\n  methods: {\r\n    // 获取全部器材信息\r\n    async getAllEquipInfo() {\r\n      this.showList = [];\r\n      const results = await this.$store.dispatch(\"getAllEquipInfo\");\r\n      if (results.code == 200) {\r\n        results.data.forEach((item) => {\r\n          // this.equiptype.push({tid:item.tid,type:item.type});\r\n          if (!this.equiptype.some((res) => res.tid === item.tid)) {\r\n            this.equiptype.push({ tid: item.tid, type: item.type });\r\n          }\r\n        });\r\n        this.equipList = results.data;\r\n        this.showList = this.equipList.slice(\r\n          (this.currentPage - 1) * this.limit,\r\n          this.limit * this.currentPage\r\n        );\r\n        this.total = this.equipList.length;\r\n        // 类型去重\r\n        // this.equiptype = Array.from(new Set(this.equiptype))\r\n        // this.equiptype = [...new Set(this.equiptype)];\r\n\r\n        // console.log(this.equiptype)\r\n      }\r\n    },\r\n\r\n    // 展示相应器材数据\r\n    change() {\r\n      this.currentPage = 1;\r\n      this.zidingyi();\r\n    },\r\n\r\n    // 保修或者报废\r\n    async handle(row, type) {\r\n      // console.log(row.status, type);\r\n      let params = {};\r\n      type == 0\r\n        ? (params = { eid: row.eid, status: 0 })\r\n        : type == 1\r\n        ? (params = { eid: row.eid, status: 1 })\r\n        : (params = { eid: row.eid, status: 3 });\r\n      if (row.rentstatus == 0) {\r\n        if (type == 1) {\r\n          // console.log('a')\r\n          if (row.status == 0 || row.status == 2) {\r\n            // console.log('b')\r\n            const results = await this.$store.dispatch(\"handleEquip\", params);\r\n            if (results.code == 200) {\r\n              this.$notify.success({\r\n                title: \"成功\",\r\n                message: \"报修成功\",\r\n              });\r\n              this.getAllEquipInfo();\r\n            } else {\r\n              this.$notify.error({\r\n                title: \"失败\",\r\n                message: \"报修失败\",\r\n              });\r\n            }\r\n          } else if (row.status == 1) {\r\n            // console.log('c')\r\n            this.$notify.warning({\r\n              title: \"提示\",\r\n              message: \"器材已报修，不可重复操作\",\r\n            });\r\n          } else {\r\n            // console.log('d')\r\n            this.$notify.error({\r\n              title: \"提示\",\r\n              message: \"器材已报废，不能进行该操作\",\r\n            });\r\n          }\r\n        } else if (type == 0) {\r\n          console.log(\"a\");\r\n          if (row.status == 3) {\r\n            this.$notify.warning({\r\n              title: \"提示\",\r\n              message: \"该器材已报废\",\r\n            });\r\n          } else {\r\n            const results = await this.$store.dispatch(\"handleEquip\", params);\r\n            if (results.code == 200) {\r\n              this.$notify.success({\r\n                title: \"成功\",\r\n                message: \"状态更改成功\",\r\n              });\r\n              this.getAllEquipInfo();\r\n            } else {\r\n              this.$notify.error({\r\n                title: \"失败\",\r\n                message: \"状态更改失败\",\r\n              });\r\n            }\r\n          }\r\n        } else {\r\n          if (row.status != 3) {\r\n            const results = await this.$store.dispatch(\"handleEquip\", params);\r\n            if (results.code == 200) {\r\n              this.$notify.success({\r\n                title: \"成功\",\r\n                message: \"报废成功\",\r\n              });\r\n              this.getAllEquipInfo();\r\n            } else {\r\n              this.$notify.error({\r\n                title: \"失败\",\r\n                message: \"报废失败\",\r\n              });\r\n            }\r\n          } else {\r\n            this.$notify.error({\r\n              title: \"提示\",\r\n              message: \"器材已报废，不能进行该操作\",\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        this.$notify.warning({\r\n          title: \"提示\",\r\n          message: \"器材被借用，不能进行操作\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 新增器材\r\n    add() {\r\n      this.$refs.form.validate(async (valid) => {\r\n        if (valid) {\r\n          this.equipinfo.eid = \"EQ\" + this.equipinfo.eid;\r\n          const results = await this.$store.dispatch(\r\n            \"addEquip\",\r\n            this.equipinfo\r\n          );\r\n          if (results.code == 200) {\r\n            this.$notify.success({\r\n              title: \"成功\",\r\n              message: \"添加成功\",\r\n            });\r\n            this.getAllEquipInfo();\r\n            this.isShow = false;\r\n          } else {\r\n            this.$notify.error({\r\n              title: \"失败\",\r\n              message: \"添加失败\",\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    // 批量选中\r\n    handleSelectionChange(val) {\r\n      this.selectList = val;\r\n      console.log(val);\r\n    },\r\n    // 批量删除\r\n    deletes() {\r\n      let deleteList = [];\r\n      try {\r\n        this.selectList.forEach((item) => {\r\n          this.$store.dispatch(\"deleteEquip\", item);\r\n        });\r\n        this.getAllEquipInfo();\r\n        this.$notify.success({\r\n          title: \"成功\",\r\n          message: \"删除成功\",\r\n        });\r\n      } catch (error) {\r\n        this.$notify.error({\r\n          title: \"失败\",\r\n          message: \"删除失败\",\r\n        });\r\n      }\r\n    },\r\n    // 分页器\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val;\r\n      this.zidingyi();\r\n    },\r\n    handleSizeChange(val) {\r\n      this.limit = val;\r\n      this.currentPage = 1;\r\n      this.getAllEquipInfo();\r\n    },\r\n    zidingyi() {\r\n      this.showList = [];\r\n      if (this.select == \"\") {\r\n        this.showList = this.equipList.slice(\r\n          (this.currentPage - 1) * this.limit,\r\n          this.limit * this.currentPage\r\n        );\r\n        this.total = this.equipList.length;\r\n      } else {\r\n        let temArr = [];\r\n        // console.log(this.select)\r\n        this.equipList.forEach((item) => {\r\n          if (this.select == item.tid) {\r\n            temArr.push(item);\r\n          }\r\n        this.showList = temArr.slice(\r\n          (this.currentPage - 1) * this.limit,\r\n          this.limit * this.currentPage\r\n        );\r\n        this.total = temArr.length;\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.form {\r\n  width: 450px;\r\n  position: relative;\r\n  left: 50%;\r\n  margin-left: -300px;\r\n  top: 60%;\r\n}\r\n.select{\r\n    display: inline-block;\r\n    width:120px;\r\n    \r\n}\r\n.select /deep/ .el-input__inner{\r\n    border-radius: 0 5px 5px 0!important; \r\n}\r\n.btn{\r\n    margin-left: 15%;\r\n    border-radius: 5px 0 0 5px;\r\n}\r\n</style>\r\n"]}]}